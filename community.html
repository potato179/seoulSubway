<!doctype html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>수도권 전동차 정보</title>
        <script type="text/javascript" src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
        <link rel = "stylesheet" href = "https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity = "sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin = "anonymous">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js" integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW" crossorigin="anonymous"></script>
        <script src = "https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity = "sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV" crossorigin = "anonymous"></script>
        <script src = "https://kit.fontawesome.com/06fb83cb17.js" crossorigin = "anonymous"></script>
        <link rel="preconnect" href="https://fonts.gstatic.com">
        <link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic:wght@800&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="https://potato179.github.io/style/potato-min.css">
        <style>
            body{
                font-family: 'Nanum Gothic', sans-serif;        
            }
        </style>
    </head>
    <body class = "" onload = "logincookie()">
        <nav class = "navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
            <div class = "container">
                <img src = "./public/img/icon.png" width = "50px;">&nbsp;&nbsp;
                <a class = "navbar-brand" href = "./index.html" style = "font-weight: bold;"></a>
                <button class = "navbar-toggler" type = "button" data-toggle = "collapse" data-target = "#navbarCollapse" aria-controls = "navbarCollapse" aria-expanded = "false">
                <span class = "navbar-toggler-icon"></span>
                </button>
                <div class = "collapse navbar-collapse" id = "navbarCollapse">
                    <ul class = "navbar-nav mr-auto">
                        <li class = "nav-item active">
                            <a class = "nav-link" href = "./index.html">홈<span class = "sr-only"></span></a>
                        </li>
                        <li class = "nav-item active">
                            <a class = "nav-link" href = "./arrivals.html">실시간 도착정보<span class = "sr-only"></span></a>
                        </li>
                        <li class = "nav-item active">
                            <a class = "nav-link" href = "./station.html?1270">역 정보<span class = "sr-only"></span></a>
                        </li>
                        <li class = "nav-item active">
                            <a class = "nav-link" href = "./community.html">게시판<span class = "sr-only"></span></a>
                        </li>
                        <li class = "nav-item active">
                            <a class = "nav-link" href = "./info.html">누리집 정보<span class = "sr-only"></span></a>
                        </li>
                        <li class = "nav-item dropdown">
                            <a class = "nav-link dropdown-toggle" href = "#" id = "dropdown07XL" data-bs-toggle = "dropdown" aria-expanded = "false">자료실</a>
                            <ul class = "dropdown-menu" aria-labelledby = "dropdown07XL">
                                <li><a class = "dropdown-item" href = "./trainInfo.html#">전동차 정보</a></li>
                                <li><a class = "dropdown-item" href = "#">가상 행선안내기</a></li>
                            </ul>
                        </li>
                    </ul>
                    <a style = "margin: 5px" class = "btn btn-outline-primary" id = "log_in_out" type = "button" onclick = 'window.location.href = "login.html"'>로그인</a>
                    <a style = "margin: 5px" class = "btn btn-outline-primary" id = "btn_join" type = "button" onclick = 'window.location.href = "join.html"'>회원가입</a>
                </div>
            </div>
        </nav>
        <div class = "center">
            <br><br><br><br>
            <h1>질문게시판</h1>
        </div>
        <main role = "main" class = "container">
            <br><hr><br>
            <button id = "writequestion" onclick = "window.location.href = 'writequestion.html'">글쓰기</button>
            <div id="view_q">

            </div>
            <table id = "q_table" class = "table">
                <thead>
                    <tr class = "gray">
                        <th scope = "col">#</th>
                        <th scope = "col">제목</th>
                        <th scope = "col">글쓴이</th>
                        <th scope = "col">처리현황</th>
                    </tr>
                </thead>
                <tbody id = "q_list" class = "black">
                </tbody>
            </table>
            </div>            
            <br><hr><br>
            <br><br><br><br><br><br>
        </main>
        <script src = "../public/js/jquery.cookie.js"></script>
        <script>
            function logincookie(){
                var userEmail = $.cookie("userEmail");
                if(userEmail != '' && userEmail != null){
                    console.log("쿠키 존재: " + userEmail);
                    $("#log_in_out").html("로그아웃");
                    $("#log_in_out").attr("onclick", 'window.location.href = "logout"');
                    var username = $.cookie("username");
                    $("#btn_join").html(username + "님, 반갑습니다");
                    var t = document.getElementById("btn_join");
                    t.style.color = "red";
                    $("#btn_join").attr("onclick", '');
                }
                else{
                    console.log("쿠키가 존재하지 않습니다");

                    $("#log_in_out").html("로그인");
                    $("#log_in_out").attr("onclick", 'window.location.href = "login.html"');
                }

                var ajaxData = { 
                    type: "GET", 
                    url : "get_questions",
                    data: {}, 
                    dataType: "json",
                    success: function(data, status, xhr){
                        console.log(data);
                        //$("#questions").html("daflasdhfkadhfakds");
                        var tempStr = "";
                        data.forEach(function(item, index){
                            tempStr += `<tr onclick = 'ViewQuestion(${item.id})'>
                                    <th scope="row">${item.id}</th>
                                    <td>${item.title}</td>
                                    <td>${item.writer}</td>
                                    <td>${item.category}</td>
                                </tr>
                            `
                        });
                        $("#q_list").html(tempStr);
                    },
                    error: function(jqXHR, textStatus, errorThrown){
                    }
                };
                $.ajax(ajaxData);

            }

            function comment(id){
                var comments = document.getElementById("comment").value;
                var ajaxData = {
                    type: "GET",
                    url: "write_comment",
                    data: {comments: comments, id: id, email: $.cookie("userEmail"), userName: $.cookie("username")},
                    dataType: "json",
                    success: function(data, status, xhr){
                        console.log(data)
                        alert(data.message);
                        window.location.href = "index.html";
                    }
                }
                $.ajax(ajaxData)
            }

            function ViewQuestion(id){
                console.log(`질문: ` + id);

                var ajaxData = { 
                    type: "GET", 
                    url : "view_question",
                    data: {id: id}, 
                    dataType: "json", 
                    success :  function(data, status, xhr){
                        console.log(data);

                        $('#q_table').html('');

                        let question_info;
                        question_info = `<br><h1>${data.title}</h1>
                        <p>작성자: ${data.writer}</p><br><br>
                        ${data.content}
                        <br><br><br><br><br>
                        <button onclick = window.location.href='/community.html'>목록으로</button>
                        `

                        if(data.comment != undefined){
                            var commentList = JSON.parse(data.comment);
                            if(commentList){
                                commentList.forEach(function(element, index){
                                    console.log(element);
                                    question_info += `<br><div>${element.name}: ${element.text}</div>`
                                });
                            }
                        }
                        $('#view_q').html(question_info);
                    },
                    error:  function(jqXHR, textStatus, errorThrown){
                    }
                };

                $.ajax(ajaxData);
            }
        </script>
    </body>
</html>